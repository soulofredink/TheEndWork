{"version":3,"file":"index.js","sources":["pages/index/index.vue","D:/HBuiderX/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class='search'>\n      <uni-search-bar \n        @confirm=\"search\" \n        :focus=\"true\" \n        v-model=\"searchValue\"  \n        @input=\"input\" \n        @cancel=\"cancel\" \n        @change=\"change\"\n      ></uni-search-bar>\n    </view>\n\n    <!-- 导航栏 -->\n    <view class='navigator'>\n      <view \n        v-for=\"(item, index) in navList\" \n        :key=\"index\" \n        class=\"nav-item\"\n        :class=\"{ active: currentIndex === index }\"\n        @click=\"switchTab(index)\"\n      >\n        {{ item }}\n      </view>\n    </view>\n\n    <!-- 内容区域 -->\n    <swiper \n      :current=\"currentIndex\" \n      @change=\"onSwiperChange\"\n      :style=\"{ height: swiperHeight + 'rpx' }\"\n    >\n      <swiper-item v-for=\"(item, index) in navList\" :key=\"index\">\n        <scroll-view scroll-y :style=\"{ height: swiperHeight + 'rpx' }\">\n          <!-- 推荐商品 -->\n          <view v-if=\"index === 0\">\n            <view v-for=\"goods in bookList\" :key=\"goods.id\" class=\"goods-item\">\n              <image class=\"goods-image\" :src=\"goods.image\" mode=\"aspectFill\"></image>\n              <view class=\"goods-info\">\n                <text class=\"goods-title\">{{ goods.name }}</text>\n                <text class=\"goods-price\">{{ goods.price }}元</text>\n              </view>\n            </view>\n          </view>\n\n          <!-- 新发商品 -->\n          <view v-if=\"index === 1\">\n            <view v-for=\"goods in gameList\" :key=\"goods.id\" class=\"goods-item\">\n              <image class=\"goods-image\" :src=\"goods.image\" mode=\"aspectFill\"></image>\n              <view class=\"goods-info\">\n                <text class=\"goods-title\">{{ goods.name }}</text>\n                <text class=\"goods-price\">{{ goods.price }}元</text>\n              </view>\n            </view>\n          </view>\n\n          <!-- 最近浏览 -->\n          <view v-if=\"index === 2\">\n            <view v-for=\"goods in lifeUtilList\" :key=\"goods.id\" class=\"goods-item\">\n              <image class=\"goods-image\" :src=\"goods.image\" mode=\"aspectFill\"></image>\n              <view class=\"goods-info\">\n                <text class=\"goods-title\">{{ goods.name }}</text>\n                <text class=\"goods-price\">{{ goods.price }}元</text>\n              </view>\n            </view>\n          </view>\n        </scroll-view>\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref, watch, watchEffect } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { useChatStore } from '../../store/chatStore'\nimport { useUserStore } from '../../store/useUserStore'\nimport { ServerURL,WebsocketURL } from '../../config'\r\nimport { User } from '../../static/interface/User'\r\nimport { Goods } from '../../static/interface/goods'\r\nimport { ListRes } from '../../static/interface/ListRes'\n// 状态管理\nconst chatStore = useChatStore()\nconst userStore = useUserStore()\n\n// 响应式数据\nconst searchValue = ref(\"\")\nconst navList = ref(['图书', '游戏', '生活用品'])\nconst currentIndex = ref(0)\nconst swiperHeight = ref(0)\r\n\nconst bookList = ref([])\nconst gameList = ref([])\nconst lifeUtilList = ref([])\n// 生命周期\nonLoad(() => {\r\n\tfetchBookData()\r\n\tfetchGame()\r\n\tfetchLifeUtil()\r\n\tconst t=uni.getStorageSync(\"token\")\r\n\tif(t==true){\r\n\t\tuserStore.meta.isLoggedin=true\r\n\t\tuserStore.currentUser=uni.getStorageSync('userInfo') as User\r\n\t}\r\n\t\n\tconst systemInfo = uni.getWindowInfo()\n\tswiperHeight.value = systemInfo.windowHeight - 50\n\tuni.__f__('log','at pages/index/index.vue:108',\"index:\", userStore.meta.isLoggedin)\n})\n\n// 事件处理\nconst switchTab = (index: number) => {\n  currentIndex.value = index\n}\n\nconst onSwiperChange = (e: any) => {\n  currentIndex.value = e.detail.current\n}\r\n\n//点击头像等信息跳转聊天界面\nconst test = async (contactId: string) => {\n  try {\n    // 创建会话\n    chatStore.createSession(contactId)\n    chatStore.updatereceiverId(contactId)\r\n\tuni.__f__('log','at pages/index/index.vue:126',userStore.currentUser.id)\n    // 获取用户信息\n    const res :any= await uni.request({\r\n      url: ServerURL+\"/add\",\r\n      method: 'GET',\r\n      data:{\r\n    \t  sid:userStore.currentUser.id,\r\n\t\t  otherid:contactId\r\n      }\r\n    })\r\n\tuni.__f__('log','at pages/index/index.vue:136',\"点击头像进入聊天\")\r\n\tuni.__f__('log','at pages/index/index.vue:137',\"连接后端状态码：\",res.statusCode)\n    if (res.statusCode === 200) {\n      const chatInfo = {\n        id: contactId,\n        avatar: res.data.img,\n        username: res.data.username\n      }\n      \n      uni.navigateTo({\n        url: `/pages/communicateDetails/communicateDetails?id=${chatInfo.id}&username=${chatInfo.username}&avatar=${chatInfo.avatar}`\n      })\n    }\n  } catch (error) {\n    uni.__f__('error','at pages/index/index.vue:150','用户信息获取失败:', error)\n    uni.showToast({ title: '连接失败', icon: 'none' })\n  }\n}\n\n// 搜索相关函数\nconst search = (res: any) => {\n  uni.showToast({\n    title: '搜索：' + res.value,\n    icon: 'none'\n  })\n}\n\nconst input = (res: any) => uni.__f__('log','at pages/index/index.vue:163','input--', res)\nconst cancel = (res: any) => uni.__f__('log','at pages/index/index.vue:164',\"cancel\", res)\nconst change = (res: any) => uni.__f__('log','at pages/index/index.vue:165',\"change\", res)\n// 数据获取函数\n\tconst fetchBookData = async () => {\n\t  try {\r\n\t\t  let random=Date.now()%10\n\t    const res = await uni.request({\n\t      url: ServerURL + '/get/goods/图书',\n\t      method: 'POST',\r\n\t\t  header:{\r\n\t\t  \t'Content-Type': 'application/json'\r\n\t\t  },\n\t      data: { page: random, size: 20 }\n\t    })\n\t    if (res.statusCode === 200) {\n\t      let resVal =res.data as {code:number,message:string,data:any}\n\t\t  let date = resVal.data as ListRes;\r\n\t\t  bookList.value = date.list\n\t      //bookList.value.push(data)//加进数组\n\t    }\n\t  }\n\t  catch (error) {\n\t  \t    uni.showToast({ title: '图书商品加载失败', icon: 'none' })\n\t  \t  }\n\t}\n\t\n\tconst fetchGame = async () => {\n\t  try {\r\n\t\tlet random=Date.now()%10\n\t    const res = await uni.request({\n\t      url: ServerURL + '/get/goods/游戏',\n\t      method: 'POST',\r\n\t\t  header:{\r\n\t\t  \t'Content-Type': 'application/json'\r\n\t\t  },\n\t      data: { page: random, size: 20 }\n\t    })\n\t    if (res.statusCode === 200) {\n\t      let resVal =res.data as {code:number,message:string,data:any}\r\n\t      let date = resVal.data as ListRes;\r\n\t      gameList.value = date.list\n\t    }\n\t  }\n\t  catch (error) {\n\t  \t    uni.showToast({ title: '游戏商品加载失败', icon: 'none' })\n\t  \t  }\n\t}\n\n\tconst fetchLifeUtil = async () => {\n\t  try {\r\n\t\t   let random=Date.now()%10\n\t    const res = await uni.request({\n\t      url: ServerURL+\"/get/goods/生活用品\",\n\t      method: 'POST',\n\t      data: { page: random, size: 20 }\n\t    })\n\t    if (res.statusCode === 200) {\n\t      let resVal =res.data as {code:number,message:string,data:any}\r\n\t      let date = resVal.data as ListRes;\r\n\t      lifeUtilList.value = date.list\n\t    }\n\t  }\n\t  catch (error) {\n\t  \t    uni.showToast({ title: '生活用品商品加载失败', icon: 'none' })\n\t    }\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n@mixin text-ellipsis($lines: 1) {\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: $lines;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\npage {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n\n.container {\n  display: flex;\n  flex-direction: column;\n  width: 100vw;\n  height: 100vh;\n  background: #f8f8f8;\n}\n\n.search {\n  padding: 20rpx 30rpx;\n  background: #fff;\n  box-shadow: 0 4rpx 16rpx rgba(0,0,0,0.08);\n}\n\n.navigator {\n  display: flex;\n  height: 65rpx;  \n  position: relative;\n  background: #fff;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.06);\n  border-bottom: 1rpx solid #f5f5f5;\n  white-space: nowrap;\n  overflow-x: auto;\n}\n\n.nav-item {\n  flex: 1;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 28rpx;\n  color: #666;\n  position: relative;\n  transition: all 0.3s;\n\n  &.active {\n    color: #007AFF;\n    font-weight: 500;\n\n    &::after {\n      content: '';\n      position: absolute;\n      left: 50%;\n      bottom: 8rpx;\n      width: 60rpx;\n      height: 4rpx;\n      background: #007AFF;\n      transform: translateX(-50%);\n      border-radius: 2rpx;\n      transition: all 0.3s;\n    }\n  }\n\n  &:active {\n    background: rgba(0,122,255,0.05);\n  }\n}\n\n.goods-item {\n  display: flex;\n  padding: 20rpx;\n  margin-bottom: 20rpx;\n  background: #fff;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.08);\n}\n\n.goods-image {\n  width: 200rpx;\n  height: 200rpx;\n  border-radius: 8rpx;\n  margin-right: 20rpx;\n}\n\n.goods-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.goods-title {\n  font-size: 28rpx;\n  color: #333;\n  line-height: 1.4;\n  @include text-ellipsis(2);\n}\n\n.goods-price {\n  font-size: 32rpx;\n  color: #ff5000;\n  font-weight: bold;\n  margin-top: 10rpx;\n}\n\n.test-buttons {\n  padding: 20rpx;\n  display: flex;\n  gap: 20rpx;\n  justify-content: center;\n  \n  button {\n    padding: 10rpx 30rpx;\n    background-color: #007AFF;\n    color: white;\n    border-radius: 40rpx;\n  }\n}\n</style>","import MiniProgramPage from 'E:/uniappWorkSpace/SaltyFish/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useChatStore","useUserStore","ref","onLoad","uni","ServerURL"],"mappings":"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"}