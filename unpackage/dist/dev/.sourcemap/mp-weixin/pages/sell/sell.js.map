{"version":3,"file":"sell.js","sources":["pages/sell/sell.vue","D:/HBuiderX/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsbC9zZWxsLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 图片上传区域 -->\n\t\t<view class=\"image-box\" @tap=\"addImage\" :class=\"{ 'image-active': !isText }\">\n\t\t\t<text v-if=\"isText\" class=\"tip-text\">+ 点击添加商品图片</text>\n\t\t\t<image \n\t\t\t\tv-if=\"!isText\"\n\t\t\t\tmode=\"aspectFill\" \n\t\t\t\t:src=\"src\" \n\t\t\t\tclass=\"preview-image\"\n\t\t\t\t@tap.stop=\"handleImageTap\"\n\t\t\t/>\n\t\t\t<view v-if=\"!isText\" class=\"delete-mask\" @tap.stop=\"deleteImage\">\n\t\t\t\t<text class=\"iconfont icon-shanchu\">X</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 商品信息表单 -->\n\t\t<view class=\"goods-info\">\n\t\t\t<uni-forms :modelValue=\"good\">\n\t\t\t\t<uni-forms-item label=\"名称\" name=\"name\">\n\t\t\t\t\t<input type=\"text\" v-model=\"good.name\" placeholder=\"请输入商品名称\" @blur=\"isVaild('name')\"/>\n\t\t\t\t</uni-forms-item>\n\t\t\t\t<uni-forms-item label=\"价格\" name=\"price\">\n\t\t\t\t\t<input type=\"text\" v-model=\"good.price\" placeholder=\"请输入价格\" @blur=\"isVaild('price')\"/>\n\t\t\t\t</uni-forms-item>\n\t\t\t\t<uni-forms-item required name=\"type\" label=\"类型\">\n\t\t\t\t\t<input  v-model=\"good.type\" placeholder=\"商品类型\" @tap=\"chooseType\" @blur=\"isVaild('type')\" readonly/>\n\t\t\t\t</uni-forms-item>\n\t\t\t\t<uni-forms-item required name=\"description\" label=\"描述\" >\n\t\t\t\t\t<textarea \n\t\t\t\t\t      v-model=\"good.description\"\n\t\t\t\t\t      placeholder=\"请输入商品描述（140字以内）\"\n\t\t\t\t\t      placeholder-style=\"color: #999;\"\n\t\t\t\t\t      auto-height\n\t\t\t\t\t\t  @focus=\"changeIsFocus\"\n\t\t\t\t\t\t  @blur=\"onBlur\"\n\t\t\t\t\t\t  :class=\"{\n\t\t\t\t\t\t        'description-box': true,\n\t\t\t\t\t\t        'description-focus': isFocus\n\t\t\t\t\t\t      }\"\r\n\t\t\t\t\t\t\n\t\t\t\t\t    />\n\t\t\t\t\t    <!-- 字数统计 -->\n\t\t\t\t\t    <view class=\"word-count\">\n\t\t\t\t\t      {{ good.description.length }}/140\n\t\t\t\t\t    </view>\n\t\t\t\t</uni-forms-item>\n\t\t\t</uni-forms>\r\n\t\t\t<view class=\"submit-btn\">\r\n\t\t\t\t<button type=\"primary\" @click=\"submitForm\">立即发布</button>\r\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, reactive, ref,watch } from 'vue';\nimport { useUserStore } from '../../store/useUserStore';\nimport {useCheckGoods} from '../../hooks/useCheckGoods'\n\nconst userStore = useUserStore();\nconst isText = ref(true);\nconst src = ref(\"\");\nconst formRef = ref();\nlet isFocus = ref(false)\n//检测逻辑变量\n\r\n\nfunction changeIsFocus(){\n\tisFocus.value = true;\n}\n\n\t\nfunction onBlur(){\n\tisFocus.value = false\r\n\tisVaild(\"description\")\n}\n\n\nwatch(good,(New)=>{\n\tuni.__f__('log','at pages/sell/sell.vue:82',New)\n},{deep:true})\nconst itemList = [\"图书\",\"游戏\",\"生活用品\"]\nfunction chooseType(){\n\tuni.showActionSheet({\n\t\titemList,\n\t\tsuccess: (res) => {\n\t\t\tgood.type = itemList[res.tapIndex]; \n\t\t}\n\t})\n}\n\n// 添加图片\nfunction addImage() {\n\tuni.chooseImage({\n\t\tcount: 1,\n\t\tsizeType: ['compressed'],\n\t\tsourceType: ['album', 'camera'],\n\t\tsuccess: (res) => {\n\t\t\tif (res.tempFilePaths[0]) {\n\t\t\t\tisText.value = false;\n\t\t\t\tsrc.value = res.tempFilePaths[0];\n\t\t\t\tgood.image = src.value;\n\t\t\t}\n\t\t},\n\t\tfail: (err) => {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '图片选择失败',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t}\n\t});\n}\n\n// 删除图片\nfunction deleteImage() {\n\tuni.showModal({\n\t\ttitle: '提示',\n\t\tcontent: '确定要删除这张图片吗？',\n\t\tsuccess: (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\tisText.value = true;\n\t\t\t\tsrc.value = \"\";\n\t\t\t\tgood.image = \"\";\n\t\t\t}\n\t\t}\n\t});\n}\n\n// 提交表单\nasync function submitForm() {\n\ttry {\n\t\tawait formRef.value.validate();\n\t\t\n\t\tif (!good.image) {\n\t\t\treturn uni.showToast({ title: '请上传商品图片', icon: 'none' });\n\t\t}\n\t\tgood.userId=userStore.currentUser.id;\n\t\t// TODO: 调用提交接口\n\t\tuni.__f__('log','at pages/sell/sell.vue:141',good.userId)\n\t\tuni.showLoading({ title: '提交中...' });\n\t\t\n\t\t// 模拟接口调用\n\t\tsetTimeout(() => {\n\t\t\tuni.hideLoading();\n\t\t\tuni.showToast({ title: '发布成功' });\n\t\t\tsetTimeout(() => uni.navigateBack(), 1500);\n\t\t}, 1000);\n\n\t} catch (err) {\n\t\tuni.showToast({\n\t\t\ttitle: '请填写完整信息',\n\t\t\ticon: 'none'\n\t\t});\n\t}\n}\n\n// 点击图片预览\nfunction handleImageTap() {\n\tuni.previewImage({\n\t\turls: [src.value],\n\t\tcurrent: 0\n\t});\n}\nconst uploadToServer = async (filePath:string) => {\n\t  const {statusCode,data} = await uni.uploadFile({\n\t      url:\"http://192.168.43.78:8080/\"+good.type,\n\t      filePath: filePath, \n\t      name:'file',     \n\t  })\n\t  if (statusCode === 200) {\n\t\tuni.__f__('log','at pages/sell/sell.vue:173',\"1111\")\n\t    return data; \n\t  }\n\t  throw new Error('上传失败');\n}\n\r\n\t\r\n\r\n\r\n\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n\tpadding: 30rpx;\n}\n\n.image-box {\n\theight: 450rpx;\n\twidth: 100%;\n\tborder: 2rpx dashed #ddd;\n\tborder-radius: 16rpx;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tbackground: #f9f9f9;\n\tposition: relative;\n\toverflow: hidden;\n\timage{\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t&.image-active {\n\t\tborder-color: #007AFF;\n\t\tbackground: #f0f7ff;\n\t}\n\n\t.tip-text {\n\t\tcolor: #666;\n\t\tfont-size: 28rpx;\n\t}\n\n\t.preview-image {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\ttransition: transform 0.3s;\n\t\t\n\t\t&:active {\n\t\t\ttransform: scale(0.98);\n\t\t}\n\t}\n\n\t.delete-mask {\n\t\tdisplay:flex;\n\t\tposition: absolute;\n\t\tright: 0;\n\t\ttop: 0;\n\t\tbackground: rgba(0,0,0,0.5);\n\t\tpadding: 10rpx 16rpx;\n\t\tborder-radius: 0 0 0 16rpx;\n\t\twidth:30rpx;\n\t\theight:30rpx;\n\t\tjustify-self: center;\n\t\talign-items: center;\n\t\t.icon-shanchu {\n\t\t\tcolor: #b2b2b2;\n\t\t\tfont-size: 36rpx;\n\t\t}\n\t}\n}\n\n\t.goods-info {\n\t\tmargin-top: 40rpx;\n\t\tposition: relative;\n\t\tinput{\n\t\t\tposition: absolute;\n\t\t\ttop:12rpx;\n\t\t}\n\t}\n\t\n    .submit-btn {\n\tmargin: 60rpx 30rpx 0;\n\t\n\tbutton {\n\t\tborder-radius: 50rpx;\n\t\theight: 88rpx;\n\t\tfont-size: 32rpx;\n\t}\n}\n\tdescription-box {\n\t  /* 基础样式 */\n\t  width: 100%;\n\t  min-height: 200rpx;\n\t  padding: 20rpx;\n\t  border: 2rpx solid #e5e5e5;\n\t  border-radius: 12rpx;\n\t  font-size: 28rpx;\n\t  line-height: 1.5;\n\t  color: #333;\n\t  box-sizing: border-box;\n\t  overflow-y: visible;\n\t}\n  /* 聚焦状态 */\n  description-focus {\n    border-color: #007AFF;\n    outline: none;\n  }\n</style>","import MiniProgramPage from 'E:/uniappWorkSpace/SaltyFish/pages/sell/sell.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","watch","uni"],"mappings":";;;;;;;;;;;;;;;;AA6DA,UAAM,YAAYA,mBAAAA;AACZ,UAAA,SAASC,kBAAI,IAAI;AACjB,UAAA,MAAMA,kBAAI,EAAE;AAClB,UAAM,UAAUA,cAAAA;AACZ,QAAA,UAAUA,kBAAI,KAAK;AAIvB,aAAS,gBAAe;AACvB,cAAQ,QAAQ;AAAA,IACjB;AAGA,aAAS,SAAQ;AAChB,cAAQ,QAAQ;AAChB,cAAQ,aAAa;AAAA,IACtB;AAGMC,wBAAA,MAAK,CAAC,QAAM;AACbC,oBAAAA,MAAA,MAAM,OAAM,6BAA4B,GAAG;AAAA,IAAA,GAC9C,EAAC,MAAK,KAAA,CAAK;AACb,UAAM,WAAW,CAAC,MAAK,MAAK,MAAM;AAClC,aAAS,aAAY;AACpBA,oBAAAA,MAAI,gBAAgB;AAAA,QACnB;AAAA,QACA,SAAS,CAAC,QAAQ;AACZ,eAAA,OAAO,SAAS,IAAI,QAAQ;AAAA,QAClC;AAAA,MAAA,CACA;AAAA,IACF;AAGA,aAAS,WAAW;AACnBA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAQ;AACb,cAAA,IAAI,cAAc,CAAC,GAAG;AACzB,mBAAO,QAAQ;AACX,gBAAA,QAAQ,IAAI,cAAc,CAAC;AAC/B,iBAAK,QAAQ,IAAI;AAAA,UAClB;AAAA,QACD;AAAA,QACA,MAAM,CAAC,QAAQ;AACdA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACN;AAAA,QACF;AAAA,MAAA,CACA;AAAA,IACF;AAGA,aAAS,cAAc;AACtBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChB,mBAAO,QAAQ;AACf,gBAAI,QAAQ;AACZ,iBAAK,QAAQ;AAAA,UACd;AAAA,QACD;AAAA,MAAA,CACA;AAAA,IACF;AAGA,mBAAe,aAAa;AACvB,UAAA;AACG,cAAA,QAAQ,MAAM;AAEhB,YAAA,CAAC,KAAK,OAAO;AAChB,iBAAOA,cAAAA,MAAI,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAAA,QACxD;AACK,aAAA,SAAO,UAAU,YAAY;AAElCA,sBAAA,MAAI,MAAM,OAAM,8BAA6B,KAAK,MAAM;AACxDA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAGnC,mBAAW,MAAM;AAChBA,wBAAA,MAAI,YAAY;AAChBA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B,qBAAW,MAAMA,cAAA,MAAI,aAAa,GAAG,IAAI;AAAA,WACvC,GAAI;AAAA,eAEC,KAAK;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AAAA,IACD;AAGA,aAAS,iBAAiB;AACzBA,oBAAAA,MAAI,aAAa;AAAA,QAChB,MAAM,CAAC,IAAI,KAAK;AAAA,QAChB,SAAS;AAAA,MAAA,CACT;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKA,GAAG,WAAW,eAAe;"}