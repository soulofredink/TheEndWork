{"version":3,"file":"sell.js","sources":["pages/sell/sell.vue","D:/HBuiderX/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsbC9zZWxsLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 图片上传区域 -->\n\t\t<view class=\"image-box\" @tap=\"addImage\" :class=\"{ 'image-active': !isText }\">\n\t\t\t<text v-if=\"isText\" class=\"tip-text\">+ 点击添加商品图片</text>\n\t\t\t<image \n\t\t\t\tv-if=\"!isText\"\n\t\t\t\tmode=\"aspectFill\" \n\t\t\t\t:src=\"src\" \n\t\t\t\tclass=\"preview-image\"\n\t\t\t\t@tap.stop=\"handleImageTap\"\n\t\t\t/>\n\t\t\t<view v-if=\"!isText\" class=\"delete-mask\" @tap.stop=\"deleteImage\">\n\t\t\t\t<text class=\"iconfont icon-shanchu\">X</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 商品信息表单 -->\n\t\t<view class=\"goods-info\">\n\t\t\t<uni-forms :modelValue=\"good\" :rules=\"rules\">\r\n\t\t\t\t<uni-forms-item label=\"名称\" name=\"name\">\r\n\t\t\t\t\t<input type=\"text\" v-model=\"good.name\" placeholder=\"请输入商品名称\" />\r\n\t\t\t\t</uni-forms-item>\r\n\t\t\t\t<uni-forms-item label=\"价格\" name=\"price\">\r\n\t\t\t\t\t<input type=\"text\" v-model=\"good.price\" placeholder=\"请输入价格\" />\r\n\t\t\t\t</uni-forms-item>\r\n\t\t\t\t<uni-forms-item required name=\"type\" label=\"类型\">\r\n\t\t\t\t\t<input  v-model=\"good.type\" placeholder=\"商品类型\" @tap=\"chooseType\" readonly/>\r\n\t\t\t\t</uni-forms-item>\r\n\t\t\t\t<uni-forms-item required name=\"description\" label=\"描述\" >\r\n\t\t\t\t\t<textarea \r\n\t\t\t\t\t      v-model=\"good.description\"\r\n\t\t\t\t\t      placeholder=\"请输入商品描述（255字以内）\"\r\n\t\t\t\t\t      placeholder-style=\"color: #999;\"\r\n\t\t\t\t\t      auto-height\r\n\t\t\t\t\t\t  @focus=\"changeIsFocus\"\r\n\t\t\t\t\t\t  @blur=\"onBlur\"\r\n\t\t\t\t\t\t  :class=\"{\r\n\t\t\t\t\t\t        'description-box': true,\r\n\t\t\t\t\t\t        'description-focus': isFocus\r\n\t\t\t\t\t\t      }\"\r\n\t\t\t\t\t    />\r\n\t\t\t\t\t    <!-- 字数统计 -->\r\n\t\t\t\t\t    <view class=\"word-count\">\r\n\t\t\t\t\t      {{ good.description.length }}/250\r\n\t\t\t\t\t    </view>\r\n\t\t\t\t</uni-forms-item>\r\n\t\t\t</uni-forms>\r\n\t\t\t<view class=\"submit-btn\">\r\n\t\t\t\t<button type=\"primary\" @click=\"submitForm\">立即发布</button>\r\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, reactive, ref,watch } from 'vue';\nimport { useUserStore } from '../../store/useUserStore';\n\r\n\nconst userStore = useUserStore();\nconst isText = ref(true);\nconst src = ref(\"\");\nconst formRef = ref();\nlet isFocus = ref(false)\r\n\r\n\t\r\nfunction changeIsFocus(){\r\n\tisFocus.value = true;\r\n}\r\n\r\n\t\r\nfunction onBlur(){\r\n\tisFocus.value = false;\r\n}\nconst good = reactive({\n  userId: computed(() => userStore.currentUser?.id || \"\"),\n  name: \"\", \n  price: null,\n  description: \"\",\n  image: \"\",\r\n  type:\"\",\n})\r\n\r\nwatch(good,(New)=>{\r\n\tuni.__f__('log','at pages/sell/sell.vue:86',New)\r\n},{deep:true})\nconst itemList = [\"图书\",\"游戏\",\"生活用品\"]\r\nfunction chooseType(){\r\n\tuni.showActionSheet({\r\n\t\titemList,\r\n\t\tsuccess: (res) => {\r\n\t\t\tgood.type = itemList[res.tapIndex]; \r\n\t\t}\r\n\t})\r\n}\r\n\n// 添加图片\nfunction addImage() {\n\tuni.chooseImage({\n\t\tcount: 1,\n\t\tsizeType: ['compressed'],\n\t\tsourceType: ['album', 'camera'],\n\t\tsuccess: (res) => {\n\t\t\tif (res.tempFilePaths[0]) {\n\t\t\t\tisText.value = false;\n\t\t\t\tsrc.value = res.tempFilePaths[0];\n\t\t\t\tgood.image = src.value;\r\n\t\t\t}\n\t\t},\n\t\tfail: (err) => {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '图片选择失败',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t}\n\t});\n}\n\n// 删除图片\nfunction deleteImage() {\n\tuni.showModal({\n\t\ttitle: '提示',\n\t\tcontent: '确定要删除这张图片吗？',\n\t\tsuccess: (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\tisText.value = true;\n\t\t\t\tsrc.value = \"\";\n\t\t\t\tgood.image = \"\";\n\t\t\t}\n\t\t}\n\t});\n}\n\n// 提交表单\nasync function submitForm() {\n\ttry {\n\t\tawait formRef.value.validate();\n\t\t\n\t\tif (!good.image) {\n\t\t\treturn uni.showToast({ title: '请上传商品图片', icon: 'none' });\n\t\t}\n\n\t\t// TODO: 调用提交接口\n\t\t\n\t\tuni.showLoading({ title: '提交中...' });\n\t\t\n\t\t// 模拟接口调用\n\t\tsetTimeout(() => {\n\t\t\tuni.hideLoading();\n\t\t\tuni.showToast({ title: '发布成功' });\n\t\t\tsetTimeout(() => uni.navigateBack(), 1500);\n\t\t}, 1000);\n\n\t} catch (err) {\n\t\tuni.showToast({\n\t\t\ttitle: '请填写完整信息',\n\t\t\ticon: 'none'\n\t\t});\n\t}\n}\n\n// 点击图片预览\nfunction handleImageTap() {\n\tuni.previewImage({\n\t\turls: [src.value],\n\t\tcurrent: 0\n\t});\n}\r\nconst uploadToServer = async (filePath:string) => {\r\n\t  const {statusCode,data} = await uni.uploadFile({\r\n\t      url:\"http://192.168.43.78:8080/\"+good.type,\r\n\t      filePath: filePath, \r\n\t      name:'file',     \r\n\t  })\r\n\t  if (statusCode === 200) {\r\n\t\tuni.__f__('log','at pages/sell/sell.vue:177',\"1111\")\r\n\t    return data; \r\n\t  }\r\n\t  throw new Error('上传失败');\r\n}\r\nlet rules: {\r\n\t// 对name字段进行必填验证\r\n\tname: {\r\n\t\t// name 字段的校验规则\r\n\t\trules:[\r\n\t\t\t// 校验 name 不能为空\r\n\t\t\t{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请填写名称',\r\n\t\t\t},\r\n\t\t\t// 对name字段进行长度验证\r\n\t\t\t{\r\n\t\t\t\tminLength: 1,\r\n\t\t\t\tmaxLength: 20,\r\n\t\t\t\terrorMessage: '{label}长度在 {minLength} 到 {maxLength} 个字符',\r\n\t\t\t}\r\n\t\t],\r\n\t\t// 当前表单域的字段中文名，可不填写\r\n\t\tlabel:'姓名',\r\n\t\tvalidateTrigger:'submit'\r\n\t},\r\n\tprice: {\r\n\t\trules:[\r\n\t\t\t{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请填写价格',\r\n\t\t\t},\r\n\t\t],\r\n\t\tlabel:'价格',\r\n\t\tvalidateTrigger:'submit'\r\n\t},\r\n\ttype: {\r\n\t\trules:[\r\n\t\t\t{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择类型',\r\n\t\t\t},\r\n\t\t],\r\n\t\tlabel:'类型',\r\n\t\tvalidateTrigger:'submit'\r\n\t},\r\n\tdescription: {\r\n\t\trules:[\r\n\t\t\t{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请填写你的商品介绍',\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tminLength: 12,\r\n\t\t\t\tmaxLength: 140,\r\n\t\t\t\terrorMessage: '{label}长度在 {minLength} 到 {maxLength} 个字符',\r\n\t\t\t}\r\n\t\t],\r\n\t\t\r\n\t\tlabel:'描述',\r\n\t\tvalidateTrigger:'submit'\r\n\t}\r\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n\tpadding: 30rpx;\n}\n\n.image-box {\n\theight: 450rpx;\n\twidth: 100%;\n\tborder: 2rpx dashed #ddd;\n\tborder-radius: 16rpx;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tbackground: #f9f9f9;\n\tposition: relative;\n\toverflow: hidden;\n\timage{\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\n\t&.image-active {\n\t\tborder-color: #007AFF;\n\t\tbackground: #f0f7ff;\n\t}\n\n\t.tip-text {\n\t\tcolor: #666;\n\t\tfont-size: 28rpx;\n\t}\n\n\t.preview-image {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\ttransition: transform 0.3s;\n\t\t\n\t\t&:active {\n\t\t\ttransform: scale(0.98);\n\t\t}\n\t}\n\n\t.delete-mask {\r\n\t\tdisplay:flex;\n\t\tposition: absolute;\n\t\tright: 0;\n\t\ttop: 0;\n\t\tbackground: rgba(0,0,0,0.5);\n\t\tpadding: 10rpx 16rpx;\n\t\tborder-radius: 0 0 0 16rpx;\n\t\twidth:30rpx;\r\n\t\theight:30rpx;\r\n\t\tjustify-self: center;\r\n\t\talign-items: center;\n\t\t.icon-shanchu {\n\t\t\tcolor: #b2b2b2;\n\t\t\tfont-size: 36rpx;\n\t\t}\n\t}\n}\n\n\t.goods-info {\n\t\tmargin-top: 40rpx;\r\n\t\tposition: relative;\r\n\t\tinput{\r\n\t\t\tposition: absolute;\r\n\t\t\ttop:12rpx;\r\n\t\t}\n\t}\n\t\n    .submit-btn {\n\tmargin: 60rpx 30rpx 0;\n\t\n\tbutton {\n\t\tborder-radius: 50rpx;\n\t\theight: 88rpx;\n\t\tfont-size: 32rpx;\n\t}\n}\r\n\tdescription-box {\n\t  /* 基础样式 */\n\t  width: 100%;\n\t  min-height: 200rpx;\n\t  padding: 20rpx;\n\t  border: 2rpx solid #e5e5e5;\n\t  border-radius: 12rpx;\n\t  font-size: 28rpx;\n\t  line-height: 1.5;\n\t  color: #333;\n\t  box-sizing: border-box;\r\n\t  overflow-y: visible;\n\t}\n  /* 聚焦状态 */\n  description-focus {\n    border-color: #007AFF;\n    outline: none;\n  }\n</style>","import MiniProgramPage from 'E:/uniappWorkSpace/SaltyFish/pages/sell/sell.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","reactive","computed","watch","uni"],"mappings":";;;;;;;;;;;;;;;;AA4DA,UAAM,YAAYA,mBAAAA;AACZ,UAAA,SAASC,kBAAI,IAAI;AACjB,UAAA,MAAMA,kBAAI,EAAE;AAClB,UAAM,UAAUA,cAAAA;AACZ,QAAA,UAAUA,kBAAI,KAAK;AAGvB,aAAS,gBAAe;AACvB,cAAQ,QAAQ;AAAA,IACjB;AAGA,aAAS,SAAQ;AAChB,cAAQ,QAAQ;AAAA,IACjB;AACA,UAAM,OAAOC,cAAAA,SAAS;AAAA,MACpB,QAAQC,cAAS,SAAA,MAAM;;AAAA,gCAAU,gBAAV,mBAAuB,OAAM;AAAA,OAAE;AAAA,MACtD,MAAM;AAAA,MACN,OAAO;AAAA,MACP,aAAa;AAAA,MACb,OAAO;AAAA,MACP,MAAK;AAAA,IAAA,CACN;AAEKC,wBAAA,MAAK,CAAC,QAAM;AACbC,oBAAAA,MAAA,MAAM,OAAM,6BAA4B,GAAG;AAAA,IAAA,GAC9C,EAAC,MAAK,KAAA,CAAK;AACb,UAAM,WAAW,CAAC,MAAK,MAAK,MAAM;AAClC,aAAS,aAAY;AACpBA,oBAAAA,MAAI,gBAAgB;AAAA,QACnB;AAAA,QACA,SAAS,CAAC,QAAQ;AACZ,eAAA,OAAO,SAAS,IAAI,QAAQ;AAAA,QAClC;AAAA,MAAA,CACA;AAAA,IACF;AAGA,aAAS,WAAW;AACnBA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAQ;AACb,cAAA,IAAI,cAAc,CAAC,GAAG;AACzB,mBAAO,QAAQ;AACX,gBAAA,QAAQ,IAAI,cAAc,CAAC;AAC/B,iBAAK,QAAQ,IAAI;AAAA,UAClB;AAAA,QACD;AAAA,QACA,MAAM,CAAC,QAAQ;AACdA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACN;AAAA,QACF;AAAA,MAAA,CACA;AAAA,IACF;AAGA,aAAS,cAAc;AACtBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChB,mBAAO,QAAQ;AACf,gBAAI,QAAQ;AACZ,iBAAK,QAAQ;AAAA,UACd;AAAA,QACD;AAAA,MAAA,CACA;AAAA,IACF;AAGA,mBAAe,aAAa;AACvB,UAAA;AACG,cAAA,QAAQ,MAAM;AAEhB,YAAA,CAAC,KAAK,OAAO;AAChB,iBAAOA,cAAAA,MAAI,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAAA,QACxD;AAIAA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAGnC,mBAAW,MAAM;AAChBA,wBAAA,MAAI,YAAY;AAChBA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B,qBAAW,MAAMA,cAAA,MAAI,aAAa,GAAG,IAAI;AAAA,WACvC,GAAI;AAAA,eAEC,KAAK;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AAAA,IACD;AAGA,aAAS,iBAAiB;AACzBA,oBAAAA,MAAI,aAAa;AAAA,QAChB,MAAM,CAAC,IAAI,KAAK;AAAA,QAChB,SAAS;AAAA,MAAA,CACT;AAAA,IACF;AAaI,QAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpLJ,GAAG,WAAW,eAAe;"}